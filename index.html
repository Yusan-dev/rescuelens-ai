<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json">
    <title>RescueLens AI - Kesiapsiagaan Bencana</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/models/mobilenet"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); }
        #video-container { position: relative; width: 100%; max-width: 500px; margin: auto; }
        #canvas { position: absolute; top: 0; left: 0; }
    </style>
</head>
<body class="bg-gray-100 font-sans">

    <header class="gradient-bg text-white p-6 text-center shadow-lg">
        <h1 class="text-2xl font-bold">RESCUELENS AI</h1>
        <p class="text-sm opacity-90">Deteksi Bahaya & Panduan Darurat Real-time</p>
    </header>

    <main class="p-4 max-w-2xl mx-auto">
        <section class="bg-white rounded-xl shadow-md p-4 mb-6 text-center">
            <h2 class="font-bold text-gray-700 mb-2">üì∏ AI Structural Scanner</h2>
            <p class="text-xs text-gray-500 mb-4 font-semibold italic">Arahkan kamera ke dinding atau area terdampak</p>
            
            <div id="video-container" class="rounded-lg overflow-hidden bg-black aspect-video">
                <video id="webcam" autoplay playsinline muted class="w-full h-full object-cover"></video>
            </div>
            
            <div id="status-box" class="mt-4 p-3 rounded-lg bg-gray-200">
                <p id="prediction-text" class="font-bold text-lg text-blue-700 italic uppercase">Memulai AI...</p>
                <p id="confidence-text" class="text-xs text-gray-600">Mohon tunggu...</p>
            </div>
        </section>

        <section class="bg-white rounded-xl shadow-md p-4">
            <h2 class="font-bold text-gray-700 mb-4">üí¨ Panduan P3K & Evakuasi (AI Chat)</h2>
            <div id="chat-box" class="h-48 overflow-y-auto border-b mb-4 p-2 text-sm bg-gray-50">
                <div class="mb-2"><strong>AI:</strong> Apa kondisi darurat yang Anda hadapi? (Contoh: "Gempa", "Luka Bakar", "Banjir")</div>
            </div>
            <div class="flex gap-2">
                <input type="text" id="user-input" placeholder="Tanyakan bantuan..." class="flex-1 border p-2 rounded-lg outline-none focus:ring-2 focus:ring-blue-500">
                <button onclick="askAI()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Kirim</button>
            </div>
        </section>
    </main>

    <script>
        let model;
        const video = document.getElementById('webcam');
        const predictionText = document.getElementById('prediction-text');
        const confidenceText = document.getElementById('confidence-text');

        // 1. Load AI Model (MobileNet untuk Image Recognition)
        async function loadModel() {
            predictionText.innerText = "Memuat AI Model...";
            model = await mobilenet.load();
            predictionText.innerText = "Sistem Siap!";
            startCamera();
        }

        // 2. Akses Kamera
        async function startCamera() {
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: "environment" }, 
                audio: false 
            });
            video.srcObject = stream;
            predictLoop();
        }

        // 3. Loop Prediksi Real-time
        async function predictLoop() {
            const predictions = await model.classify(video);
            
            if (predictions.length > 0) {
                const topResult = predictions[0].className.toLowerCase();
                const prob = Math.round(predictions[0].probability * 100);

                // Logika deteksi bahaya (Custom mapping sederhana untuk demo)
                if (topResult.includes('crack') || topResult.includes('wall') || topResult.includes('rubble')) {
                    predictionText.innerText = "‚ö†Ô∏è POTENSI BAHAYA STRUKTUR";
                    predictionText.className = "font-bold text-lg text-red-600";
                } else {
                    predictionText.innerText = "KONDISI TERPANTAU NORMAL";
                    predictionText.className = "font-bold text-lg text-green-600";
                }
                confidenceText.innerText = `Akurasi Analisis: ${prob}% (${topResult})`;
            }
            requestAnimationFrame(predictLoop);
        }

        // 4. Chatbot Logic (Simulasi NLP Darurat)
        function askAI() {
            const input = document.getElementById('user-input').value.toLowerCase();
            const chatBox = document.getElementById('chat-box');
            let response = "Maaf, tetap tenang. Hubungi 112. Coba tanya: 'Gempa' atau 'Luka'.";

            if (input.includes("gempa")) {
                response = "Gunakan metode DROP, COVER, HOLD ON. Jauhi kaca dan benda tinggi.";
            } else if (input.includes("luka") || input.includes("darah")) {
                response = "Tekan area luka dengan kain bersih untuk menghentikan pendarahan.";
            } else if (input.includes("banjir")) {
                response = "Matikan listrik rumah, amankan dokumen, dan menuju ke titik kumpul tinggi.";
            }

            chatBox.innerHTML += `<div class="mb-2 text-right"><strong>Anda:</strong> ${input}</div>`;
            chatBox.innerHTML += `<div class="mb-2 text-blue-700"><strong>AI:</strong> ${response}</div>`;
            document.getElementById('user-input').value = "";
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        loadModel();
    </script>
</body>
</html>
